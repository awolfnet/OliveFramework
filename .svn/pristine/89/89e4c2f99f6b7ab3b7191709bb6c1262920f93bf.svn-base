using OliveFramework.Model.Datatable;
using OliveFramework.Model.Response;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;

namespace OliveFramework.Controller
{
    public class Merchant: BaseController
    {
        private static Merchant _instance = null;
        public static Merchant Instance
        {
            set
            {

            }
            get
            {
                if (_instance == null)
                {
                    _instance = new Merchant();
                }
                return _instance;
            }
        }

        public MerchantListModel GetMerchantList(String productName,String marketName)
        {

            string where = "";
            if(!String.IsNullOrWhiteSpace(productName))
            {
                where += string.Format("view_merchantlist.product_name = '{0}'", productName);
            }


            if(!String.IsNullOrWhiteSpace(marketName))
            {
                if (!String.IsNullOrWhiteSpace(where))
                    where += " AND ";

                where += string.Format("view_merchantlist.market_name = '{0}'", marketName);
            }

            //string.Format("view_merchantlist.product_name = '{0}' AND view_merchantlist.market_name = '{1}'", productName, marketName);

            List<MerchantModel> list = db.SelectData<MerchantModel>("view_merchantlist",null, where,true);

            if(list==null)
            {
                throw new UnfulfilException("/language/database/no_record");
            }

            MerchantListModel merchantList = new MerchantListModel();

            foreach (MerchantModel merchant in list)
            {
                merchantList.Add(merchant);
            }
            return merchantList;

        }

    }
}